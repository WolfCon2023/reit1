FROM node:18-slim AS build
WORKDIR /app
COPY package.json package-lock.json ./
COPY packages/shared/package.json packages/shared/
COPY apps/web/package.json apps/web/
RUN npm ci
COPY packages/shared packages/shared
COPY apps/web apps/web
RUN npm run build:web

FROM node:18-slim
WORKDIR /app
COPY --from=build /app/apps/web/dist apps/web/dist
COPY --from=build /app/apps/web/server.cjs apps/web/server.cjs
EXPOSE 4173
ENV PORT=4173
CMD ["node", "apps/web/server.cjs"]
